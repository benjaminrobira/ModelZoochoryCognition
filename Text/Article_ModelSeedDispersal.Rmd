---
title: "The role of seed-dispersing animal cognition in shaping plant distributions"
# "Animal cognition as a cause and consequence of resource distribution heterogeneity"
# "Eco-evolutionary feedback loops between animal cognition, movement and resource distribution"
# The role of animal cognition in shaping resource distribution via zoochory
# date: "`r format(Sys.time(), '%B %d, %Y')`"

#I follow: https://stackoverflow.com/questions/52918716/authors-and-affiliations-in-the-yaml-of-rmarkdown for author display
author: 
  - name: Benjamin Robira \orcidlink{0000-0002-3168-6573}
    email: benjamin.robira@normalesup.org
    institute: FEM
    correspondence: true
institute:
  - FEM: Animal Ecology Unit, Research and Innovation Centre, Fondazione Edmund Mach, San Michele all'Adige, TN, Italy

output: 
 #      - '--lua-filter=scholarly-metadata.lua'
 #      - '--lua-filter=author-info-blocks.lua'
 bookdown::pdf_document2:
   number_sections: true
   toc: false
   citation_package: biblatex
   latex_engine: pdflatex
   fig_caption: true
   pandoc_args:
     - '--lua-filter=scholarly-metadata/scholarly-metadata.lua'
     - '--lua-filter=author-info-blocks/author-info-blocks.lua'
always_allow_html: true

bibliography: bibliographyarticlepackage.bib
biblio-style: apa
biblatexoptions: [natbib=true, sorting=nyt, uniquename=false, uniquelist=false]

urlcolor: gray
filecolor: gray
link-citations: yes
linkcolor: gray
citecolor: gray
fontsize: 11pt

header-includes:
  #Lato font
  - \usepackage[default]{lato}
  - \usepackage{lipsum}% for dummy text
  - \renewcommand{\mddefault}{l}
  #Orcid link
  - \usepackage{orcidlink}
  #Emoticone
  - \usepackage{fontawesome5}
  #Customise page
  - \usepackage{fancyhdr}
  - \usepackage{lastpage} #Number of lastpage
  #- \pagenumbering{gobble} #for no page numbering
  - \usepackage{pdfpages}
  # #Underline text
  # - \usepackage{ulem}
  #For graybox
  - \usepackage{tcolorbox}
  #For pictures, drawing...
  - \usepackage{tikz}
  #For title sections
  - \usepackage{titlesec}
  #Lettrine
  - \usepackage{lettrine}
  #Customise legend figure
  - \usepackage[rightcaption]{sidecap}
  - \usepackage{graphicx}
  - \usepackage{subcaption}
  - \usepackage{floatrow}
  - \usepackage{caption}
  #Multiple columns
  - \usepackage{multicol}
  #To have lines around title
  - \usepackage{titling}
  - \pretitle{
    \begin{flushleft}
    \rule[-0.15in]{0.25\linewidth}{0.8ex}
    \vspace{-0.8ex}
    \hrule
    \vspace{0.3in}
    \begin{LARGE}
    \noindent
    \textbf
    }
  - \posttitle{
    \end{LARGE}\newline
    \rule[-0.15in]{0.25\linewidth}{0.8ex}
    \hrule
    \end{flushleft}
    \vspace{0.2in}}
  - \usepackage{lettrine}  
  #- \usepackage[nolists, nomarkers,tablesfirst]{endfloat} # For figures and tables at end
  - \usepackage{lineno} # For line numbering
  - \linenumbers # For line numbering
  #- \usepackage{setspace}\doublespacing
  - \usepackage{fontawesome} #for fa symbols
  - \usepackage{tcolorbox}
  #- \pagenumbering{gobble} #for no page numbering
  - \setlength{\parskip}{0em} #to remove line gaps
  #- \setlength{\parindent}{2em} #to indent new paragraph
  - \DeclareUnicodeCharacter{2212}{-}
  - \usepackage{caption}
  - \captionsetup[figure]{font=small}
  - \newcommand{\beginsupplement}{
    \setcounter{table}{0}  
    \renewcommand{\thetable}{A\arabic{table}} 
    \setcounter{figure}{0} 
    \renewcommand{\thefigure}{A\arabic{figure}}
    } 
---

```{r child = 'layout.Rmd'}
```

```{r setup, include=FALSE, echo=FALSE, message=FALSE}
knitr::opts_chunk$set(
  include = FALSE,
  echo = FALSE,
  message = FALSE,
  warning = FALSE
)
knitr::opts_chunk$set(dpi = 300) # Figure resolution and size out.width = '100%',
knitr::opts_chunk$set(fig.pos = 'p')#, fig.align = 'center') # Places figures on pages separate from text, centered
knitr::opts_chunk$set(fig.env = "figure") # Latex figure environment
knitr::opts_knit$set(eval.after = "fig.cap") #To insert R code into R figure caption
                      
#My toolbox with several functions
source("../Scripts/R/toolbox.R")

#Libraries used
library(png)
library(ggplot2)
library(scales)
library(ggpubr)

#Updating bibliography
citeR(
bibliographyArticle = "../Text/bibliography.bib",
bibliographyOutput = "../Text/bibliographyarticlepackage.bib",
Rcpp,
cccd,
gwfa,
ape,
igraph,
adehabitatLT
)

#Load environment for parametrisation
load("../Renvironment/resultsTestIndex2.RData")
load("../Scripts/R/Parameterisation.RData")
percentToAssumeDifference = 5

#Set theme for all graphs
theme_set(
  theme_bw() +
  theme(axis.title = element_text(face = "bold", size = 16),
        axis.text.x = element_text(size = 12),
        axis.text.y = element_text(size = 12),
        legend.text = element_text(size = 10),
        legend.title = element_text(size = 12, face = "bold"),
        panel.grid.minor = element_line(colour = "grey93"),
        panel.grid.major = element_line(colour = "grey93"),
        strip.background = element_rect(colour = "white",
                                        fill = "white"),
        strip.text = element_text(face = "bold", size = 14))
)

```

\captionsetup{list=no}

\hfill

```{r}
words <- RmdWords("Article_ModelSeedDispersal.Rmd")
```

<!-- When an animal engages in food searching, its cognition can be stimulated, as it may need to remember where and when to find food.  -->


:::: {.contouronlybox data-latex=""}

**Abstract |** In the wild, an evolutionary play takes place in an unchanging setting, or so current hypotheses on the evolution of spatiotemporal cognition of animals implicitly assume. However, if plant-eating vagile animals are likely to have their spatiotemporal cognition shaped by the distribution of plant resources, their movement may shape the way resources are distributed as well, for example by dispersing seeds. Using an agent-based model simulating the foraging behaviour of a seed disperser endowed with spatiotemporal knowledge of resource distribution, I investigated whether resource spatiotemporal patterns could be influenced by the level of cognition involved in foraging. This level of cognition represented how well resource location and phenology were predicted by the agent. I showed that seed dispersers could shape the long-term distribution of resources by materialising the routes repeatedly used by the forager with the newly recruited trees. This stemmed from the conjunction of two forces: competition for space between trees and a seed-dispersing forager moving from tree to tree based on spatiotemporal memory. In turn, resource landscape modifications affected the benefits of spatiotemporal memory, hence the selection gradient that applies to cognition. This could create eco-evolutionary feedback loops between animal spatiotemporal cognition and the distribution patterns of plant resources. Altogether, the results emphasise that foraging cognition is a cause and a consequence of resource heterogeneity. 

<!-- Cognition can shape the movement of animals such as for frugivores. As frugivores can be involved in the life cycle of plants, for example in seed dispersal (i.e. zoochory), their cognition could also shape resource distribution patterns. As resource distribution patterns are known to affect the benefits of cognition, this could create eco-evolutionary feedback loops between animal cognition and the spatiotemporal patterns of resources.  -->

<!-- Using an agent-based model simulating the foraging behaviour of a seed disperser endowed with spatiotemporal knowledge of resource distribution, I investigated whether resource spatiotemporal patterns could be influenced by the level of cognition involved in foraging. This level of cognition represented how well resource location and phenology were predicted by the agent. I showed that seed dispersers could shape the long-term resource distribution with the formation of materialised resource routes. This stemmed from the conjunction of two forces: competition for space between trees and a seed-dispersal forager moving from tree to tree based on spatiotemporal memory. However, the engineering of the resource landscape did not affect the selection gradient that, in turn, could apply to cognition.  -->

<!-- the more organised the resource distribution forming routes of phenologically correlated trees. -->

\hfill

\faTags \hspace{0.01in} **Keywords:** Agent-based model - Feedback loop - Foraging - Frugivory - Memory - Movement - Phenology - Seed dispersal

<!-- TC:ignore -->
\faInfoCircle  \hspace{0.01in} **Word Count:** `r words$num_words` \newline
<!-- Character Count: `r words$num_char` -->
<!-- TC:endignore --> 

::::

\newpage

\tableofcontents

\newpage

# Introduction

\initial{\textcolor{black}{H}}ypotheses about the evolution of vagile plant-eating foragers' spatiotemporal cognition (i.e. the ability to process, integrate and utilise information on resource distribution and phenology) generally assume that foragers evolve in an unchanging environment [@rosati2017foraging]. However, while foragers' cognition is likely to be shaped by the distribution of resources [@milton1981distribution; @grove2013evolution; @robiratemporalmemory; @bracis2015memory; @boyer2010modelling], the characteristics of the resources themselves could be the result of forager-induced selection [@lomascolo2010signal; @rojas2021combination]. In the tropical rainforests, for example, the cognition of frugivorous primates has probably been shaped by the challenge of the ephemerality and dispersion of their food [@milton1981distribution; @zuberbuhler2010foraging; @trapanese2019review], supporting complex [@teichroeb2019navigation; @trapanese2019whatwhere; @janson2016capuchins; @janson1998experimental; @janmaat2013mistake; @robirarandomwalk] and flexible [@trapanese2022flexibility; @janmaat2006primates] movement heuristics. In turn, primates remember and forage for the most rewarding trees [@ban2016fattyfruit; @ban2014highreward; @florchinger2010fruit]. The latter are thus more likely to have their seeds dispersed, driving plant and landscape evolution [@chapman2013primates; @lambert1998evolutionary].  

|   The way seeds are dispersed contributes to the emerging pattern of resource distribution [@vittoz2007seed]. Most of the world's plants [@tiffney1995angiosperm] and especially rainforest trees [@gottsberger1983dispersal; @bagchi2011spatial] are dispersed by animals (zoochory). Compared to other modes of dispersal, such as wind (anemochory) or gravity (gravichory), zoochory induces a less patchy distribution of adult plants [@seidler2006seed; but see @hubbell1979tree]. However, animal-dispersed fruit trees are still not homogeneously distributed [@hubbell1979tree]. This is because although travelling long distances, animals may tend to revisit memorised sites regularly, if not exclusively [@john2016memoryseed; @addis2017causes]. Furthermore, the imperfection and limited size of spatial memory [@fagan2013spatial] is expected to lead to different movement patterns [@avgar2013empirically], and therefore potentially to different patterns of resource distribution [@cortes2013integrating]. By being affected by cognition and by affecting resource dispersal, animal movement could thus lead to eco-evolutionary feedback loops between animal cognition and resource dispersal [@borah2022studying]. In other words, foraging cognition could be both a cause and a consequence of resource heterogeneity.

|   To illustrate the possible retroactions between cognition and resource distribution, let's consider an extreme speculative scenario in which seed-dispersing frugivores are freely foraging (Figure \@ref(fig:predictions)). At start, assuming a random homogeneous distribution, long-term spatiotemporal memory can be advantageous and selected for [@grove2013evolution; @bracis2015memory]. Through zoochory, deliberate targeting of some resource patches over others may induce a change in resource distribution over time (e.g. increasing patchiness), eventually making cognition more and more advantageous [@grove2013evolution; @bracis2015memory; @boyer2010modelling]. Gradually, by repeatedly targeting the same trees, the routes used by the foragers may begin to materialise through the seeds scattered along the way. However, in doing so, foragers who can only passively follow these routes and have survived may also begin to become very efficient: they should not even have to bear the cost of high cognitive ability, putting them at an advantage over foragers who bear the burden of cognition [@raichle2006brain; @burns2011costs]. While the pattern of resource distribution can be maintained because the routes are used equally by all foragers [but through two different mechanisms: long-term memory *vs* taxis, @benhamou1995comparative; @benhamou1992distinguishing], cognition could even start to be counter-selected. 

|   While some facets of this scenario may be rooted in empirical evidence [e.g. with forest elephants, @campos2011megagardeners; @blake2004fruit; @blake2009forest], most of it remains speculative. The aim of this study is to put such a scenario to the test. Using an agent-based model simulating the movement of seed-dispersing frugivores with different cognitive abilities, I sought to investigate (a) whether and how the spatial arrangement of resource varies with the cognitive level and movement behaviour of the simulated agents, and (b) whether and how this may in turn affect the selection pressure on the agents' cognition.

```{r predictions, echo = FALSE, message = FALSE, include = TRUE, fig.align = 'center', fig.cap='Theoretical expectations on eco-evolutionary feedback loops between animal spatiotemporal cognition and resource distribution', out.width = '0.95\\linewidth'}
knitr::include_graphics("../FIG/summaryPredictions.pdf")

```

<!-- When Alice ran together with the Red Queen, she remained at the same spot. It is because %SPEECH OF THE RED QUEEN%. This picture was applied to evolutionary scenarios, in which species evolve together. -->

<!-- Animals are living in changing world. This dynamism is subject to cognitive selection. -->

<!-- Yet, despite such a bipartite framework, with animal and (plant) resource, current research discarded evolution of both side. Most papers actually discard dynamism (e.g. mine), some consider competition between individuals but static memory (e.g. louise), and some consider dynamic memory (e.g. associative memory ryal society paper lindt I think etc.). Yet, an animal might act upon its own environment too. -->

# Material and Methods

## Agent-based model

The main objective of the model was to simulate the foraging behaviour of a single agent in an environment that is dynamical both on the short term, through an interplay between resource growth and depletion, and on the long term, due to seed dispersal. For simplicity, I will refer to the agent as the forager, and to resource patches as fruit trees, but this model should find larger resonance. The model was implemented in the *C++* language in *R* software [`r extractRversion()`, @Rsoftware]  based on the *Rcpp* package [@Rcpp1; @Rcpp2; @Rcpp3].

<!-- Statistical significance was assumed considering the nominal threshold of significance $\alpha=0.05$. -->

### Environment

#### Spatial distribution

I modelled the environment as a flat square map of side `r mapSize` arbitrary spatial units (su). Within this map, `r numberTrees` trees were initially homogeneously distributed (uniform distribution of their $x$ and $y$ coordinates, resulting in a Poisson distribution of tree density).

#### Resource growth

Time was cyclical, with a period of `r cycleLength` arbitrary time units (tu). Each tree produced resource (fruit containing seeds) for `r fruitingLength` tu only once every period. Periods of productivity of each tree were randomly distributed (i.e. uniform distribution of the start date). Thus, resource was seasonal at the tree-level, but not at the map-level. Productivity was characterised by a triangular-shaped pattern of the quantity of food over time: at start of the productive period, food quantity started to increase linearly up to `r maxFoodToYield` arbitrary food unit (fu), mimicking progressive fruit ripening, and then decreased linearly to 0 fu, mimicking fruit rotting. The depletion of the food by the forager had no effect on this dynamic. Food could continue to ripen (though never to the same extent as if it had not been depleted) and rot. At a given time, the quantity of food available at a given tree thus depended on the productivity of the tree at that time, as well as the depletion history by the forager, creating a short-term dynamics of resource temporal distribution.

#### Seed dispersal

Trees reproduced by ingestion of ripe fruit by the forager and subsequent dispersal. Once the forager ate ripe fruit, seeds could be dispersed only one time up to `r timeDelayForDispersal` tu after ingestion. Dispersal occurred at a probability of `r DispersalProbability/timeDelayForDispersal` tu$^{-1}$, independent of the quantity of fruit ingested. This probability was considered low, to mimic the natural slow pace of land use changes. All fruit eaten did not mandatorily led to dispersal. Dispersal was eventually successful only if some space was left available for the new tree: no tree had to be at a distance less than `r round(0.45 * sqrt(mapSize * mapSize / (numberTrees * pi)), digits = 2)` su. This number was obtained such that the cumulative (when non-overlapping) exclusive "lifespace" by trees (a circular area of radius the aforementioned distance) could reach 45% of the map area at most (but other percentages were tested, see [Route formation as a product of two forces][Q3. Route formation as a product of two forces? Tree competition for space and forager movement step rule]). If it happened that there was available space for the seedling to grow, then the seedling location was sampled in the available space along the linear path linking the previous and current locations. Otherwise, the seedling could not grow and died. 

<!-- If considering buffer for dispersal: -->
<!-- and the current one buffer by the sensory range of the agent (`r round(perceptualRange)` su) -->

|   If the seedling was successfully dispersed and recruited, an old tree (already present in the map) was randomly selected and died to keep density constant. The start date of fruiting of the newly recruited tree was randomly sampled within a reduced Gaussian distribution (i.e. variance of one) centered on the start date of fruiting of the parent tree. The location and fruiting time of the newly recruited tree were memorised if it replaced a tree that was part of the forager's memory. The newly recruited tree was considered as mature only the year after. Seed dispersal could thus induce a long-term dynamics of resource spatial distribution and of the distribution of starting dates in the tree population.

### Agent

#### Cognitive abilities

The forager was endowed with a gradient of knowledge abilities: from no memory of the locations of trees (naive forager) and the timing of their period of productivity to perfect omniscience (i.e. all tree locations are known) and prescience (i.e. all periods of productivity are known). Otherwise, it only knew a certain proportion (fixed for the whole simulation) of tree locations and their associated phenology (hereafter *spatiotemporal knowledge rate*). These trees were selected randomly at the start of the simulation. When a tree was part of the forager's memory, the forager knew both the spatial (location) and temporal (fruiting timing) attributes. Thus, it could not know only one or the other. 

<!-- trees growing from successful seedlings were memorised, as well as trees that were visited while fruiting. In this case, they replaced known trees that were visited the longest time ago. To maintain the spatiotemporal knowledge rate constant, each time a new tree location and associate fruiting dates were memorised, those of the tree visited the longest time ago were forgotten. -->

#### Movement rules

The forager was initially randomly located within the map. It is fully aware of trees present within sensory range fixed to `r round(perceptualRange, digit=2)` su. This actually corresponds to the average nearest-neighbour distance which equates $\frac{1}{2\sqrt{\rho}}$, with $\rho$ the density of trees (here `r numberTrees/mapSize/mapSize`) at start of the simulation where trees are homogeneously distributed. It is also aware of trees that are part of its spatiotemporal long-term memory. To decide where to head next, the forager could either rely on its private knowledge (sensory or memory) or not. If all trees within its private knowledge did not yield any fruit (i.e., all having less than 0.001 fu), the forager was moving randomly. Random movements were performed by randomly choosing a direction (uniform distribution of the heading angle), while the step length was sampled within an exponential distribution of mean $\lambda_{step\,length}$ = `r exponentialRate`. An exponential distribution of step lengths is indeed classically observed in nature [@benhamou2014scales]. Otherwise, the forager targeted the `r whatRule` tree which maximised the ratio between the predicted food quantity at the tree (which accounts for depletion history), and the distance to the tree. Nonetheless, the forager avoided to target trees recently visited within the previous `r noReturnTime` tu to avoid targeting recently depleted trees [@robiratemporalmemory]. 

|   Once the target had been chosen (or random point, if none), the forager moved straight to the first tree that should have been theoretically perceived *en route* to the initial destination point if any (provided they were not recently visited), or the destination otherwise. When this destination was reached, it then re-estimated the best tree to target and so on. After each moving bout time was updated based on the distance travelled, knowing that the forager moved at a speed of `r speed` su/tu. Then, the resource quantity available at each tree was updated. 

|   In case all trees were empty (no food available in the environment, considered if the sum of food available was less than 1 fu), the forager entered a torpor period for `r torporTime` tu, and so on until food was available again. This was done to avoid biasing measure of foraging efficiency in case the forager could deplete entirely the environment while being unable to disperse to another area, as expected in nature if this happens. 

```{r modelParametersTable, include=TRUE}
source("../Scripts/R/0_Parameters.R")
library(kableExtra)
options(knitr.kable.NA = "-")
parametersValue[parametersValue[, 5] == "", 5] <- NA
knitr::kable(parametersValue, escape = TRUE, booktabs = TRUE, longtable = TRUE,
             caption = "Model parameters", align = "lllcccc") %>%
  kableExtra::kable_styling(latex_options = "striped") %>%
  kableExtra::landscape() %>%
  kable_styling(font_size = 7, full_width = FALSE)

# library(huxtable)
# as_huxtable(parametersValue) %>%
#   set_caption("Model parameters") %>%
#   add_colnames() %>% 
# #Main layout
# set_bottom_border(row = 1, col = everywhere) %>%
# set_bold(row = 1, col = everywhere) %>%
# set_background_color(evens, everywhere, "grey95") %>%
# as_flextable() #%>% 
#   # flextable::autofit() %>% 
#   # flextable::set_table_properties(layout = "autofit")

``` 

## Analyses

### Characterisation of tree distribution patterns 

To assess whether different levels of cognition resulted in different organisations of the spatial distribution of trees at the end of the simulation, I focused on three metrics describing tree spatiotemporal patterns: the *patchiness*, the *alignment* and the *spatial autocorrelation of fruiting timing*.

<!-- the *pseudo fractal dimension*, the *reticulation* -->

#### Patchiness

Patchiness (i.e. the tendency of trees to aggregate into clusters) was measured using Lloyd's index of patchiness [@lloyd1967mean]. This index is given by the following formula

\begin{center}

\hfill

$P=N_{quadrat}\frac{\sum_{i}{n_{i}(n_{i}-1)}}{(\sum_{i}{n_{i}})^2}$

\hfill

\end{center}

where $n_{i}$ represents the number of trees in quadrat *i* and $N_{quadrat}$ the number of quadrats. The map was divided in 400 square quadrats of side 50 su. The quadrat size, provided sufficient length for biological relevance, little affects the measurement [@lloyd1967mean]. Lower values indicate homogeneous distribution while larger values indicate heterogeneous and route distributions [(see Appendix Material)][Using patchiness and alignment to characterise spatial point patterns].

|   As the forager is set up to forage in a square map with reflective boundaries, seed dispersal may lead to the shrinkage of resource range towards the centre of the map (where recursions are inevitably higher), an artefact not of interest here. This would contribute to inflate measures of patchiness. I therefore calculated a measure of shrinkage *s* as one minus the area covered by the 95% of the Gaussian-based kernel distribution based on all tree locations divided by the map size. To account for variations in shrinkage in the different simulated scenarios [(see Appendix Material)][Variations in resource range shrinkage intensity], I corrected patchiness such as $P_c = P(1-s)$.


<!-- -> TO CHECK IN LLOYD PUBLICATION. I AM NOW UNSURE GIVEN THAT IT DOES WHEN I VARY THE SIZE ON SIMULATED DISTRIB. -->

<!-- 50 su was chosen because it corresponded to the lowest value before Lloyd's index of patchiness stabilised given our tree density and map size (see Appendix [Quadrat size estimation]). NOT TRUE? Why? I believed Lloyd said was insensitive to quadrat size. To verify -->

<!-- #### Pseudo-fractal dimension -->

<!-- Pseudo fractal dimension (i.e. the tendency of trees to organise in patterns insensitive to observation scale) was calculated based on a Geographically Weighted Fractal Analysis [Applying two fractal methods to characterise the local and global deviations from scale invariance of built patterns throughout mainland France] specifically developed for point patterns. In brief, for points, the fractal dimension corresponds to the slope of the regression of the logarithm of the number of points around a point of interest, as a function of the radius length to consider neighbouring points. To do so, I used the "gwfa" function of the *gwfa* package [@gwfa]. I fixed the circular neighbourhood (a measure of whether the scale is local, low radius compared to the map size, or global, large radius compared to the map size) to 200 su. The pseudo-fractal dimension corresponds to the average pseudo fractal dimension of randomly sampled points (limited to 500 within cells of side 200 su), for which I varied the counting scale (i.e. circular radius around each point of interest) from 20 su to 60 su (ten regularly spaced values in total). I use the "pseudo" prefix because I did not verify whether the calculated fractal dimension is statistically significant (i.e. if the regression slope, aimed to determine the fractal dimension, indeed offers a different fit from a constant). -->

<!-- #### Reticulation -->

<!-- Reticulation (i.e. the tendency of trees to form reticulated networks) of the tree distribution was measured following Addis (2017) [https://repositories.lib.utexas.edu/bitstream/handle/2152/68127/ADDIS-DISSERTATION-2017.pdf?sequence=1]. This method is based on the Relative Neighbourhood Graph [RNG, Toussaint, G. T. 1980. The relative neighbourhood graph of a finite planar set. Pattern Recognition 12:261–268], which should reflect the intuitive perception of reticulation a human observer might have. In this graph, two points are connected by an edge if there is no third point that is closer to the two points than the two are between each other. Such a property thus drives the visualisation of "void areas" within the distribution, since it favours immediate close-distance edge. It thus likely reflects the "routes" that are paved by trees that a forager might tend to follow. -->
<!-- I constructed the RNG as an undirected and weighted graph, where the edge weight corresponded to the Manhattan distance between the two connected points ("rng" function of the *cccd* package [@cccd]). I followed Addis (2017) and defined the reticulation as   -->
<!-- \hfill -->

<!-- $R = \frac{D - M}{max(M_{i,j})}$   -->

<!-- \hfill -->

<!-- where *D* is the diameter of the RNG. This diameter corresponds to the length of the longest of the shortest paths that connect two points within the RNG. Shortest paths between each pair of points of the RNG were obtained with the "shortest.path" function of the *igraph* package [@igraph]. *M* corresponds to the Manhattan distance between the pair of points whose shortest path equates to that of the diameter (or its average, if multiple pairs could lead to the maximum diameter length), while $M_{i,j}$ corresponds to the Euclidean distance between two points *i* and *j*. Despite I are not in a grid-based system (Addis, 2017), I used the Manhattan distance because I empirically observed that this enabled us distinguishing correctly between different spatial patterns (see Appendix [What distance to calculate reticulation?]) -->

#### Tree alignment

Routes are (curvi-)linear features. To assess the tendency of trees to form linear motifs, I quantified their alignment. For a given tree, alignment *a* was defined as one minus the minimum of the sine of the angles of the triangle formed by the tree of interest and the two closest trees. This varies from perfect alignment (value of 1), to no alignment (i.e., the minimum angle would be at worst 60° hence an alignment of ca. `r round(1 - sin(pi/3), digits = 3)`). Therefore, I used a corrected alignment $a_c$ varying from 0 (no alignment) to 1 (perfect alignment) such as

\begin{center}

\hfill

$a_{c} = \frac{a - (1 - sin(\pi/3))}{1 - (1 - sin(\pi/3))}$

\hfill

\end{center}

I defined the general alignement for a given environmental map as the opposite of the skewness of alignment values of all trees in the map. Positive values indicate the existence of linear motifs while negative values indicate no obvious linear motifs. Random distributions (homogeneous or heterogeneous) should show moderate positive values, while a route pattern should have a high positive value [(see Appendix Material)][Using patchiness and alignment to characterise spatial point patterns].

<!-- IF USING NEIGHBOURHOOD ALIGNMENT -->
<!-- other neighbouring trees. A neighbourhood was defined as a circular area of radius three times the tree lifespace (to possible have at least twice lifespace distances between the two farthest trees). If more than two trees were present, all combinations of two trees were associated to the tree of interest, and the minimum alignment among all possible combinations was eventually considered. If no tree, or only one, was found in this neighbourhood, the algorithm selected the two closest trees. -->

#### Spatial autocorrelation of fruiting timing

Spatial autocorrelation of fruiting timing (i.e. the tendency of fruiting date of trees to more closely match that of neighbours than of distant trees) was calculated as the Moran Index, \textit{I} applied to the start of fruiting dates. Since the date of start of fruiting corresponds to a circular variable, I followed [@schmal2017moran] to adapt existing functions of the *ape* package [@ape] to circular variables. Moran's \textit{I} was therefore defined as

\begin{center}

\hfill

$I = \frac{1}{\sum_{ij}{w_{ij}}}\frac{\sum_{ij}w_{ij}d(x_i,\bar{t})d(x_j,\bar{t})}{N^{-1}\sum_i d(x_i,\bar{t})^2}$

\hfill

\end{center}

<!-- $C = \frac{(N-1)}{2} \frac{\sum_{i}\sum_{j} w_{ij}d(t_i,t_j)^2}{\sum_{i,j}w_{ij}\sum_i d(x_i,\bar{t})^2}$ [@geary1954contiguity] -->


where $N$ is the number of trees, $t$ is the fruiting date (in radian), $d(t_1,t_2) = atan2(sin(t_1 - t_2), cos(t_1 - t_2))$, $\bar{t} = atan2(1/N\sum_isin(t_i), 1/N\sum_icos(t_i))$. I used the inverse of the Euclidean distance between tree locations as weights. Values of $C$ close to 0 indicate absence of spatial autocorrelation. Values close to -1 indicate negative spatial autocorrelation. Values close to 1 indicate positive spatial autocorrelation.

### Routine emergence

For each simulation, I verified whether a routine behaviour emerged and paralleled the variations in tree distribution. I characterised routine holding on the notion of conditional entropy following [@riotte2016randomness] using the series of the id of trees targeted during five supplementary seasons in which dispersal could not occur. I computed the routine possibly up to only a first order conditional entropy, as computing routine indices is computationally demanding and a first order is expected to be the most informative to describe a perfect traplining behaviour [@riotte2016randomness]. The routine index varies from 0 (no routine) to 1 (perfect traplining).

### Research questions and associated scenarios

#### Q1. Does resource spatiotemporal distribution vary with cognition level? 

To investigate whether different levels of cognition eventually led to different distribution patterns, I considered five forager types differing by the proportion of trees for which the location and phenology were known (from 0 to 100%, at a step of `r 100/length(spatialKnowledge)`). For each forager, `r numberRepetitions` simulations were performed for a given condition (i.e. knowledge rate), in which the forager foraged individually `r cycleLimitNumber` seasonal periods.

#### Q2. Does resource distribution engineering favour some cognition levels?

To investigate whether the engineered distribution of trees could in turn affect the foraging benefits purported by cognition, I used the final tree distributions of simulations computed to answer [question 1][Q1. Does resource spatiotemporal distribution vary with cognition level?]). For each of these tree distributions, in three different simulation runs, I let forage a forager endowed with no, intermediate (i.e. half of trees known), or full (all trees known, omniscience/prescience, hereafter only omniscience) spatiotemporal knowledge. In these simulations, no seed-dispersal could occur. I measured the foraging efficiency after the forager foraged for `r cycleLimitNumber/5` full seasons and compared them across environments and forager abilities. Foraging efficiency was computed as the cumulated quantity of eaten food, over the cumulated distance travelled. I verified that at the end of the simulation that foraging efficiency stabilised, which meant that I reached a foraging equilibrium. I considered that foraging efficiency stabilised when the foraging efficiency sampled after each moving bout during the fourth and fifth quintile of simulation times did not differ of more than `r percentToAssumeDifference`% (reference is the minimum efficiency in the fourth or the fifth quintile of simulation times). I repeated the simulations for a given condition (i.e. knowledge rate) `r numberRepetitions` times.


#### Q3. Route formation as a product of two forces? Tree competition for space and forager movement step rule

During the model construction, I noticed that two mechanisms could amplify the phenomenon of route formation, in addition to the use of memory: space competition between trees and sequential targeting of all trees seen *en route* to the target. To better quantify the effect of those two forces, I considered two other sets of `r numberRepetitions` simulations each.

|   To assess the effect of competition for space between trees, I compared the final tree spatiotemporal patterns when an omniscient forager (all tree locations and phenology known) was let foraging in the same setting as in question 1, with the only difference that the exclusive lifespace between trees could be of 5 (small lifespace), 45 (intermediate lifespace) or 85% (large lifespace) of the map surface, so that the radius of this exclusive circular lifespace was always inferior to the perception range (`r round(0.85 * sqrt(mapSize * mapSize / (numberTrees * pi)), digits = 2)` su vs `r round(perceptualRange, digit=2)` su).

|   To assess the effect of the movement rule of the forager on tree distribution patterns, I compared the final tree spatiotemporal patterns when an omniscient forager was let foraging in the same setting as in question 1) and while the stringency in skipping trees encountered *en route* varied. It could either stop at all trees perceived on the way to the initial target (mimicking a "monitoring" behaviour, as in all other simulations; small skipping stringency), stop only at trees currently fruiting (i.e., with at least 0.001 fu, mimicking an opportunistic feeding only; intermediate skipping stringency) or move directly to the target (large skipping stringency).


# Results

<!-- -> For figure engineering, add visualisation to guide meaning of axis: -->

<!-- Y column -->
<!-- schema for each index: -->
<!-- patchiness = aggregated point -->
<!-- route = as in figure pred -->
<!-- spatial auto corr = coloration of points following fruiting date -->
<!-- routine: network of point + segments: in circle = routine, random = no routine -->

<!-- X column: -->
<!-- def of knowledge rate -> Brain size increase, wise number of trees inside -->
<!-- def movement rule: path following trees according to rule -->
<!-- def Space tree: image trees more or less aggregated -->

```{r meanValues}

load("../Renvironment/mainResults.RData")
load("../Renvironment/outputSensitivityMovingRuleAndSpaceTree.RData")

#Getting the mean values
meanValuesMain <- indicesMain_df %>% 
  filter(time == 36500) %>% 
  group_by(knowledgeRate) %>% 
  summarise_all(mean, na.rm = TRUE)
  
meanValuesEfficiency <- indicesEfficiency_df %>% 
  group_by(initCondition, type) %>% 
  summarise_all(mean, na.rm = TRUE)

meanValuesSpacing <- indicesSpacing_df %>% 
  group_by(valueSpacing) %>% 
  summarise_all(mean, na.rm = TRUE)

meanValuesMovingRule <- indicesMovingRule_df %>% 
  group_by(movingRule) %>% 
  summarise_all(mean, na.rm = TRUE)

#Doing the comparisons of interest
patchinessToNull <- round(meanValuesMain$patchiness/meanValuesMain$patchiness[1], digits = 3)
alignmentToNull <- round(meanValuesMain$alignment/meanValuesMain$alignment[1], digits = 3)

comparisonsEfficiency <- meanValuesEfficiency %>% 
  group_by(initCondition) %>% 
  summarise(
    OmniToIntermediate = round(efficiency[type == "Omniscient"]/efficiency[type == "Intermediate"], digits = 3),
    OmniToNull = round(efficiency[type == "Omniscient"]/efficiency[type == "Null"], digits = 3)
  )

```

```{r figEngineering, fig.width=19.25, fig.height=19.25, include=TRUE, warning = FALSE, fig.cap="Seed-dispersing foragers can shape resource distribution | The plots show the results of 200 simulations when a seed-dispersing forager with varying level of cognition (i.e. proportion of tree locations and associated phenology known), moving choice rules or space competition intensities between trees (the two latter being simulated with an omniscient forager; left to right) was let foraging for a long time. The resulting distribution pattern was assessed by its patchiness (the tendency of trees to be aggregated into patches; larger values indicate highly aggregated trees), its alignement (the tendency of trees to form linear geometries; larger values indicate the presence of linear geometries) and spatial autocorelation in fruiting date (the tendency of trees to have fruiting dates closer/farther in time to their spatial neighbours; values close to 0 indicate negative spatial autocorrelation, values close to 1 indicate no spatial autocorrelation, values above 1 indicate positive spatial autocorrelation). The emerging movement behaviour of the forager was described in terms of routine behaviour (the tendency of the forager to target trees in a predictible way; values close to 0 indicate no predictible movement, values close to 1 indicate highly predictible movements)."}

mergedPlotMovingRule <- readRDS("../Renvironment/Plots/movingRulePlots.rds")
mergedPlotSpaceTree <- readRDS("../Renvironment/Plots/spacingTreePlots.rds")
mergedPlotMain <- readRDS("../Renvironment/Plots/mainPlots.rds")
mergedLegend <- readRDS("../FIG/plotLegend.rds")

library(ggplot2)
library(ggpubr)
plotEngineering <- ggarrange(
  mergedPlotMain,
  mergedPlotMovingRule,
  mergedPlotSpaceTree,
  mergedLegend,
  ncol = 4,
  widths = c(0.3,0.25,0.25,0.2)
)
plotEngineering
```

## Resource distribution is affected by the forager's cognition

Foragers' spatiotemporal knowledge rate affected the resource distribution emerging after it had been let foraging for a long time (Figure \@ref(fig:figEngineering)). Both the patchiness (the tendency of trees to be aggregated into patches) and the alignment (the tendency of trees to form linear geometries) varied non-linearily and oppositely with spatiotemporal knowledge rate. Patchiness abruptly increased and was maximised (`r patchinessToNull[2]` times superior to that when a naive forager foraged) for low cognition (spatiotemporal knowledge rate of 0.25). Conversely, alignment was minimised for this spatiotemnporal knowledge (remaining equal to when a naive forager foraged). In both cases, higher cognition led to larger patchiness (`r min(patchinessToNull[3:5])` to `r max(patchinessToNull[3:5])` times) and alignment (`r min(alignmentToNull[3:5])` to `r max(alignmentToNull[3:5])` times) than when a naive forager foraged (Figure \@ref(fig:figEngineering)).  

|   Spatial autocorrelation in fruiting date (the tendency of trees to have fruiting dates closer/farther in time to their spatial neighbours) somehow followed the same trend as patchiness (Figure \@ref(fig:figEngineering)), but the variations were quantitatively extremely reduced and values remained close to 0 (i.e., no spatial autocorrelation). 

|   Overall, such a space engineering was paralleled with the emergence of routine behaviours, which increased with spatiotemporal knowledge rate to saturate around 0.8 (Figure \@ref(fig:figEngineering)). This held when no dispersal occurred (Figure \@ref(fig:figRoutine2)).

## Engineered patterns could affect the selection gradient on spatiotemporal cognition

```{r figEfficiency, fig.width=8, fig.height=6, include=TRUE, warning = FALSE, fig.cap=" Relative foraging benefits of cognition are sensitive to the emerging resource distribution | The 'initial condition' of resource distribution was taken from the simulations in which a null, intermediate or omniscient forager was first let foraging. Then, those three forager types were let foraging (separately) without dispersal and foraging efficiency was measured (cumulated food eaten over cumulated travelled distance)."}

meanValuesEfficiency <- indicesEfficiency_df %>% 
  filter(initCondition %in% c(1,3,5)) %>% 
  mutate(efficiency = efficiency*1000,
         initCondition = ifelse(initCondition == 1, "Null", initCondition),
         initCondition = ifelse(initCondition == "3", "Intermediate", initCondition),
         initCondition = ifelse(initCondition == "5", "Omniscient", initCondition)
         ) %>% 
  group_by(initCondition, type) %>% 
  summarise_all(mean, na.rm = TRUE) %>% 
  group_by(initCondition) %>% 
  mutate(
    increaseCoeff = efficiency[type == "Omniscient"]/efficiency[type == "Intermediate"],
    increaseCoeff = ifelse(type == "Intermediate", efficiency[type == "Intermediate"]/efficiency[type == "Null"], increaseCoeff),
    increaseCoeff = round(increaseCoeff, digits = 3),
    text = paste("x", increaseCoeff),
    minY = efficiency[type == "Intermediate"],
    minY = ifelse(type == "Intermediate", efficiency[type == "Null"], minY),
    maxY = efficiency
  ) %>% 
  filter(type != "Null")

relativeIncreaseIntermediateNull_NullIntermediate <- round(meanValuesEfficiency$increaseCoeff[meanValuesEfficiency$initCondition == "Intermediate" & meanValuesEfficiency$type == "Intermediate"]/meanValuesEfficiency$increaseCoeff[meanValuesEfficiency$initCondition == "Null" & meanValuesEfficiency$type == "Intermediate"]*100 - 100, digits = 2)

relativeIncreaseIntermediateNull_NullOmniscient <- round(meanValuesEfficiency$increaseCoeff[meanValuesEfficiency$initCondition == "Omniscient" & meanValuesEfficiency$type == "Intermediate"]/meanValuesEfficiency$increaseCoeff[meanValuesEfficiency$initCondition == "Null" & meanValuesEfficiency$type == "Intermediate"]*100 - 100, digits = 2)

relativeIncreaseIntermediateOmniscient_NullIntermediate <- round((1/meanValuesEfficiency$increaseCoeff[meanValuesEfficiency$initCondition == "Intermediate" & meanValuesEfficiency$type == "Omniscient"])/(1/meanValuesEfficiency$increaseCoeff[meanValuesEfficiency$initCondition == "Null" & meanValuesEfficiency$type == "Omniscient"])*100 - 100, digits = 2)

relativeIncreaseIntermediateOmniscient_NullOmniscient <- round((1/meanValuesEfficiency$increaseCoeff[meanValuesEfficiency$initCondition == "Omniscient" & meanValuesEfficiency$type == "Omniscient"])/(1/meanValuesEfficiency$increaseCoeff[meanValuesEfficiency$initCondition == "Null" & meanValuesEfficiency$type == "Omniscient"])*100 - 100, digits = 2)

plotEfficiency <- readRDS("../Renvironment/Plots/efficiencyPlots.rds")

positionChange <- position_jitter(seed = 1)

plotEfficiency +
  geom_segment(meanValuesEfficiency,
               mapping = aes(x = initCondition, xend = initCondition, y = minY + 0.075, yend = maxY - 0.075),
               position = positionChange,
               arrow = arrow(length = unit(0.02, "npc"), ends="last"),
               color = "gray",
               size = 0.4) +
  geom_text(meanValuesEfficiency,
               mapping = aes(x = initCondition,  y = minY + (maxY - minY)/2, label = text),
               position = positionChange,
               color = "gray",
               hjust = -0.1,
               size = 3) +
  scale_fill_manual(name = "forager type", values = c("white", "grey80", "black")) #Change the colours


```

On average, an "omniscient" forager (knowing all trees' locations and phenology patterns) was around `r round(mean(comparisonsEfficiency$OmniToIntermediate[c(1,3,5)]), digits = 3)` times more efficient than an "intermediate" forager (knowing only 50% of them) or `r round(mean(comparisonsEfficiency$OmniToNull[c(1,3,5)]), digits = 3)` times than a "null" forager (knowning none of them) (Figure \@ref(fig:figEfficiency)). While the benefits of omniscience relatively to a null forager were rather constant (min-max = `r paste(round(c(min(comparisonsEfficiency$OmniToNull[c(1,3,5)]), max(comparisonsEfficiency$OmniToNull[c(1,3,5)])), digits = 3), collapse = "-")` times larger), the relative benefits of intermediate memory varied a little with the resource distribution emerging from previous engineering (Figure \@ref(fig:figEfficiency)). Compared to when the foragers foraged in an environment previously shaped by a null forager (left boxplots in Figure \@ref(fig:figEfficiency)), the relative foraging efficiency of intermediate foragers compared to null foragers increased of `r relativeIncreaseIntermediateNull_NullIntermediate`% and `r relativeIncreaseIntermediateNull_NullOmniscient`% when the foragers foraged in an environment previously shaped by an intermediate or omniscient forager, respectively (middle and right boxplots in Figure \@ref(fig:figEfficiency)). Similarly, the relative foraging efficiency of intermediate foragers compared to omniscient foragers increased of `r relativeIncreaseIntermediateOmniscient_NullIntermediate`% and `r relativeIncreaseIntermediateOmniscient_NullOmniscient`% when the forager foraged in an environment previously shaped by an intermediate or omniscient forager, respectively, compared to when the foragers foraged in an environment
previously shaped by a null forager.

## Route formation is reinforced because of opportunistic stops and by low tree space competition 

How a forager moved to the target affected the emerging resource pattern (Figure \@ref(fig:figEngineering)). In particular, moving to all trees encountered *en route* to the target induced a `r round(1/(meanValuesMovingRule$patchiness[meanValuesMovingRule$movingRule == "MovingAllTrees"]/meanValuesMovingRule$patchiness[meanValuesMovingRule$movingRule == "MovingFruitTrees"]), digits = 3)` times lower patchiness than only stopping to fruit trees and `r round(1/(meanValuesMovingRule$patchiness[meanValuesMovingRule$movingRule == "MovingAllTrees"]/meanValuesMovingRule$patchiness[meanValuesMovingRule$movingRule == "MovingTarget"]), digits = 3)` times lower than moving only to the target. 
<!-- This latter is because resource tended to be concentred to the center of the map (Figures \@ref(fig:figShrinkage) and \@ref(fig:figMapShrinkage)), but not because more routes were formed. Indeed, -->
Resource alignment was `r round((meanValuesMovingRule$alignment[meanValuesMovingRule$movingRule == "MovingAllTrees"]/meanValuesMovingRule$alignment[meanValuesMovingRule$movingRule == "MovingFruitTrees"]), digits = 3)` and `r round((meanValuesMovingRule$alignment[meanValuesMovingRule$movingRule == "MovingAllTrees"]/meanValuesMovingRule$alignment[meanValuesMovingRule$movingRule == "MovingTarget"]), digits = 3)` times higher when the forager stopped at all trees rather than only stopped fruiting trees or moved directly to the target (Figure \@ref(fig:figEngineering)). Both patchiness and alignment were considerably reduced by competition for space between trees, with patchiness `r round((meanValuesSpacing$patchiness[meanValuesSpacing$valueSpacing == 0.05]/meanValuesSpacing$patchiness[meanValuesSpacing$valueSpacing == 0.45]), digits = 3)`  and `r round((meanValuesSpacing$patchiness[meanValuesSpacing$valueSpacing == 0.05]/meanValuesSpacing$patchiness[meanValuesSpacing$valueSpacing == 0.85]), digits = 3)` times larger when competition for space between trees was low compared to when it was intermediate or high, and alignment being `r round((meanValuesSpacing$alignment[meanValuesSpacing$valueSpacing == 0.05]/meanValuesSpacing$alignment[meanValuesSpacing$valueSpacing == 0.45]), digits = 3)`  and `r round((meanValuesSpacing$alignment[meanValuesSpacing$valueSpacing == 0.05]/meanValuesSpacing$alignment[meanValuesSpacing$valueSpacing == 0.85]), digits = 3)` times larger, respectively (Figure \@ref(fig:figEngineering)).

|   Spatial autocorrelation in fruiting date remained mostly unaffected by the forager movement rule or competition for space between trees (Figure \@ref(fig:figEngineering)).  

|   Variations in movement rules were paralleled by variations in routine behaviour, with foragers moving to all trees being `r round((meanValuesMovingRule$routine[meanValuesMovingRule$movingRule == "MovingAllTrees"]/meanValuesMovingRule$routine[meanValuesMovingRule$movingRule == "MovingFruitTrees"]), digits = 3)` and `r round((meanValuesMovingRule$routine[meanValuesMovingRule$movingRule == "MovingAllTrees"]/meanValuesMovingRule$routine[meanValuesMovingRule$movingRule == "MovingTarget"]), digits = 3)` times more routine than foragers stopping only to fruit trees or their target, respectively. Competition for space between trees similarly affected the tendency of the forager to engage in routine behaviour, with a larger routine when competition for space between trees was low (Figure \@ref(fig:figEngineering)).


<!-- ```{r figMap, fig.width=7, fig.height=7, include=TRUE, warning = FALSE, fig.cap=""} -->

<!-- # -> add one figure for distribution:  -->
<!-- # - init, after naive forager ran, intermediate or prescient -->
<!-- # - init and three movement rules -->
<!-- # - init and three spacing -->

<!-- ``` -->


<!-- ```{r figChangeTime, fig.width=7, fig.height=7, include=TRUE, warning = FALSE, fig.cap=""} -->
<!-- # -> add one figure to see the changes in parameters along time for the different level of cognition -->
<!-- ``` -->

# Discussion

\initial{\textcolor{black}{T}}he environment is shaped by the species that inhabit it. The destructive behaviour of some animals when moving, such as forest elephants [@pringle2008elephants; @vanleeuwe1998forest], can lead to blatant changes, but more elusive - yet no less ecologically relevant - engineering can also occur over longer time scales. Using an agent-based model, I have illustrated the role of vagile animals in shaping the distribution of plants through zoochory. Based on a minimal set of realistic assumptions, I showed how this slow process could affect resource distribution provided that the seed-dispersing animal was endowed with cognitive abilities, which in turn shaped selection on these abilities. Therefore, this study illustrates how foraging cognition is both a cause and a consequence of resource heterogeneity.

|    As the breadth of knowledge increased, routine behaviour, the ability to repeatedly follow a fixed sequence of movements, developed [routine index > 0.8, @riotte2015memory]. The model evidenced that the emergence of such behaviour was associated with changes in the distribution of resources, which tended to become more patchy, eventually forming linear features paralleling the routes used. The agglomeration of seeds for cognitive foragers has been proposed theoretically [@john2016memoryseed] and empirically [@fragoso2003tapiraggregationseed], ultimately impacting the genetic structure and flow of plant populations [@gelmicandusso2017zoochorygenetic]. Here, the model highlighted how engineering can go further by contributing to a more organised distribution of resources, with the emergence of linear features likely to be associated with the foraging routes used due to cognition, as suggested by forest elephant routes matching with fruit gradients in the forest [@blake2009forest]. Indeed, the non-linearity of the changes in patchiness and alignment with the cognition of the forager likely corresponds to the formation of the routes themselves, with the "materialisation" first of the route intersections (hence higher patchiness, lower alignment for low cognition), where most of the recursions occur [@presotto2018intersection], before a spreading along the segment path connecting them is possible when cognition increases. This may explain why animal-dispersed plant species are less aggregated than when other dispersal mechanisms are involved, such as gravichory, where dispersed seeds do not travel far from the parent tree [@seidler2006seed]. This engineering remained yet limited because the resource patterns did not fully match the simulated route-based patterns [(see Appendix)][Using patchiness and alignment to characterise spatial point patterns]. Furthermore, despite vertical inheritance of the parent tree phenology, seed dispersal was not sufficient to drive local autocorrelation in fruiting dates. Tree synchrony is an important tool that can be used by foragers to plan their movements efficiently [@janmaat2012use]. Given the climatic drivers of large-scale synchrony, the latter can be tracked by animals [@janmaat2006primates]. A fine-scale synchrony is also observed in nature [@lamontagne2007local] and might as likely affect animal foraging success. While large-scale population trends in phenology might stem from genetic constraints [@chuine2000geneticphenology; @lyngdoh2012influence], the absence of emergence of spatial autocorrelation in fruiting date in this model may suggest a mainly non-genetic origin of these fine-scale variations for endozoochory (as implicitly assumed here) given the delay between ingestion and defecation, in the absence of other dispersal modes [e.g. gravichory, leading to highly clustered patterns, @seidler2006seed]. However, these conclusions may be challenged by more accurate modelling of movement behaviour, which may lead to different results (see below). Despite these limits, the observed spatial engineering could still be sufficient for the emergence of eco-evolutionary feedback loops between animal resources and animal movement (and cognition) [@riotte2020environmental] due to the evidenced repercussions on foragers' foraging efficiency.  

|   While the same individual might experience little change in resource distribution over its lifetime, the progressive engineering of resource distribution could overturn selection over generations. This model showed that changes in environmental conditions were likely to affect the benefits of memory, but not enough to completely overturn selection. Indeed, in all environment, memory was advantageous. The relative advantage of omniscience compared to no memory was nearly constant whatever the environment. Interestingly in contrast, the relative advantage of intermediate memory compare to no memory, was increased in engineered environments. The performance of these naive agents is clearly dependent on their sensory abilities [@grove2013evolution]. Although always superior to the randomly expected nearest neighbour distance, the sensory range modelled here may have been insufficient for simple movement strategies such as taxis to perform well. As much as memory could be favoured, the environment could also shape sensory abilities [@LaScalaGurenwald2019sensory]. Still, the changes in the relative efficiency of cognitive agents open the door to the possible emergence of evolutionary feedback loops if the costs of memory are no longer compensated, which should lead to a dynamic equilibrium [@beisner2003alternative] due to the simultaneous changes in memory benefits (hence selection) with space engineering.

|   Space engineering was reinforced by the conjunction of two forces: the forager movement rules and competition for space between trees. Maximum resource engineering was achieved when the individual moved to all the trees it encountered along the way. At the other extreme, when the animal moved directly to the best target, engineering was reduced, following routine trends. Although more efficient, moving straight to the target is rarely observed in nature. Instead, animals tend to move along routes, sometimes bypassing or otherwise opportunistically inspecting trees without resources, fitting with a beacon-based navigation, where individuals move from beacon to beacon to reach a goal [@warren2019non; @fagan2013spatial]. Such a movement strategy gives them the possibility to monitor the environment [@guinea2019arboreal], allowing them to update personal information. As such, despite short-term costs due to detours, moving to all tress might provide long-term advantages. Simulated movement patterns remain extremely simplistic and animal movement is much more nuanced than in this modelling work. This could be important for seed acquisition and deposition [@morales2022models]. This model considered directed movement supported by memory, which could alternate with random steps when memory was limited but independent of local cue feedback, as it would rather be expected for efficient foraging [@benhamou2015ultimate]. In reality, animal movement may indeed alternate between 'large-scale' directed relocation events and 'area-restricted' wandering searches of the tree in a non-random manner [@bartumeus2016foraging]. When and where area-restricted searches occur may further contribute to the emergent distribution of seed deposition [@westcott2005incorporating; @russo2006behaviourdispersal], provided that both seed deposition and foraging can occur simultaneously. Animals may yet be selective about where and when they defecate. The presence of latrines may contribute to shaping the distribution of resources too [@irwin2004lemurlatrine; @fragoso1997tapir; @pouvelle2009howlerlatrine; @fuzessy2022defecation; @sakamoto2015raccoon]. Overall, as movement and/or dispersal scales with behaviour/personality [@zwolak2018intraspecificdispersal; @brehm2022personalitydispersal; @zwolak2020personalitydispersal], but also species and individual size [@jordano2007frugivores], a multi-individual and multi-species system could lead to a more complex multi-scale scaffolding than illustrated here. This could explain why the evolution of the cognitive machinery underpinning foraging might depend on the frugivore community composition [@robira2023primate].

|   In this scaffolding, the plant itself may also play a role. Not only are seed characteristics important in the dispersal process [@albert2015traitdispersal; @fuzessy2018effects], but the success of seedling germination is highly dependent on the conditions in which the seed is deposited, due to direct or indirect actions of conspecifics. This model took into account negative interactions between trees [e.g. competition for resource, @craine2013mechanismcompetitiontree, inducing an exclusive space use] and illustrated how this could act as a barrier to spatial engineering. Indeed, as competition for space between trees increased, both patchiness and alignment logically decreased. While the model effect was interpreted as a competition for space, this may also encompass other processes such as greater exposure of seeds to predation risk in the vicinity of adult plant conspecifics [@janzen1970herbivores]. Conversely, facilitation could also occur, with the adult plants acting as a shelter for new seedlings [@callaway1995positive]. This facilitation should thus increase clustering. While directly unmodelled here, in the quasi absence of competition for space, tree range was coherently drastically reduced (i.e. shrunk; Figure \@ref(fig:figShrinkage)), with a tendency to agglomerate towards the centre of the map, where individual recurrences are likely to be most important. Therefore, the engineered patterns (e.g. from increased patchiness to route formation) may also depend on plant interactions, adding to the complexity of the system depicted.

<!-- Competition between trees: -->
<!-- Theory and Models of Inter-Plant Competition as a Spatial Process -->


\bigskip

|   The sessile lifestyle of plants may have created the illusion of residual fixity in the environmental conditions that shape the lives of frugivorous animals. While, in the absence of depletion, the resource spatial distribution is likely to remain the same in the short term, conferring the benefits of information retention in frugivores, resource spatial distribution can also change over longer periods of time. Selection could thus operate in two ways at two different evolutionary speeds: frugivores could play a key role in plant traits by actively selecting and dispersing their food over long time, while their traits could have been shaped by foraging on that primary food over shorter time. Considering the feedback loops between these different entities could be an important facet to make sense of still poorly understood patterns of co-evolution, such as the primates/angiosperms dyad [@gomez2012understanding; @sussman1991Primate; @fuzessy2022Phylogenetic; @fuzessy2023friends]. 


<!-- Model  -->
<!-- https://besjournals.onlinelibrary.wiley.com/doi/pdf/10.1111/j.1365-2745.2007.01341.x -->
<!-- https://besjournals.onlinelibrary.wiley.com/doi/pdf/10.1111/1365-2745.13287 -->

<!-- Same movement pattern and still difference in resulting pattern: -->
<!-- Valenta, Kim, et al. "Spatial patterns of primary seed dispersal and adult tree distributions: Genipa americana dispersed by Cebus capucinus." Journal of Tropical Ecology 31.6 (2015): 491-498. -->
<!-- @valenta2020dispersal;  -->

<!-- Flörchinger, M., Braun, J., Böhning-Gaese, K., & Schaefer, H. M. (2010). Fruit size, crop -->
<!-- mass, and plant height explain differential fruit choice of primates -->


# Acknowledgements

Simulations were run on the HPC cluster of the Edmund Mach Foundation. I thank Louise Riotte-Lambert and Kavel Ozturk for discussion on the model rationale and feedback on the manuscript, as well as Alexandra Loveridge for English editing.

# Funding

I was supported by the Gordon and Betty Moore Foundation.

# Declaration of conflict of interest

I declare having no conflict of interest.

# Data and code availability

The code used to generate the data and perform the analyses is available at https://github.com/benjaminrobira/ModelZoochoryCognition. To fully reproduce the analysis, a singularity image (through which the model can be run and which was used to run the simulations on the HPC cluster) can be provided on request, as it is too large to store on git.

\beginsupplement

\clearpage

<!-- # (APPENDIX) Appendix {-} -->
# Appendix

<!-- ## What distance to calculate reticulation? -->

<!-- I tested four different distance to use for establishing the Relative Neighbouring Graph, namely, the Euclidean distance (distance of norm 2, used for basics geometry), the Manhattan distance (distance of norm 1, usually adapted to grid system), the Chebychev distance (distance of infinite norm), or the Canberra distance (Weighted manhattan distance). I considered point patterns corresponding to a homogeneous distribution (Poisson distribution), a heterogeneous distribution (Poisson distribution of clusters of trees), and of route networks (see Figure \@ref(fig:figDistribution), at high density). The distribution resembling a route network was obtained by modelling ten correlated random walk of 100 steps ("simm.crw" function of the *adehabitatLT* package [@adehabitatLT], with a scaling parameter, to determine step length, of 20 su, and a concentration parameter, relative to the correlation in heading, of 0.9). All distributions included 1000 trees within a square map of side length 1000 su. I repeated measurements on `r numberOfRepetitionsForMetrics` maps for each distribution type. It emphasizes that the Manhattan distance seems the most pertinent distance to clearly distinguish between distribution reticulation, with more reticulated distributions corresponding to route network-like distributions. -->

<!-- ```{r figDistance, fig.width=7, fig.height=8, include=TRUE, warning = FALSE, fig.cap="Reticulation index as a function of the distance used for calculation | Distribution: Homo. = homogeneous, Hetero. = Heterogeneous, Route = Route network-like."} -->
<!-- theme_set(theme_bw(15)) -->
<!-- distanceReticulation.ggplot -->
<!-- ``` -->

<!-- ## Quadrat size estimation -->

<!-- As specified by @lloyd1967mean, quadrat size should little matter for calculation provided sufficient biological relevance in a homogeneous distribution (*to verify, written based on my memories of it*). Estimating such "biological relevance" in a completely artefactual world is thus rendered difficult. I thus considered different quadrat sizes (paste(patchSizeToTest, collapse=", ") su), and calculated patchiness for r numberPatchinessRepetition homogeneous or heterogeneous distribution (see below for definition) when a square map of side 1000 su contained 1000 trees. -->

## Using patchiness and alignment to characterise spatial point patterns

I provide below evidence that the two metrics, namely *patchiness* and *alignment*, allows for distinguishing between homogeneous, heterogeneous and route point patterns. In both the low (100 trees) and high (1000 trees) density, I considered 1/10 of the number of trees as the number of clusters for the heterogeneous distribution (i.e. 10 clusters at low density, 100 at high density). Around these clusters of strictly equivalent size, trees were distributed according to a Gaussian distribution (both for the *x* and *y* axis) of variance 50 su. The distribution resembling a route network was obtained by modelling one (low density) to ten (high density) correlated random walks of 100 steps ("simm.crw" function of the *adehabitatLT* package, @adehabitatLT, with a scaling parameter, to determine step length, of 20 su, and a concentration parameter, relative to the correlation in heading, of 0.9). I calculated the two metrics on `r numberOfRepetitionsForMetrics` distributions. 

<!-- Note that, because I are in "perfect" conditions, I considered a neighbourhood for the alignment of 0 su, implying that the calculation was based on the triangle formed with the two closest trees for each tree. -->

|   Homogeneous distributions are identified by a low patchiness and a low alignment. Heterogeneous distributions are identified by an intermediate patchiness and a low alignment. Finally route point distributions are evidenced by a high patchiness and a high alignment (Figure \ref{fig:figMetrics}). This pattern is robust to density variations, although absolute differences in the indices shrink with density increase (Figure \ref{fig:figMetrics}).

```{r figDistribution, fig.width=7, fig.height=8, include=TRUE, warning = FALSE, fig.cap="Simulated spatial distributions to investigate metrics value | Distribution: Homo. = homogeneous, Hetero. = Heterogeneous, Route = Route network-like. Tree population size: Low = 100 trees, High = 1000 trees, within a square map of side length 1000 su."}

distribution.ggplot +
  theme(    
    strip.text.x = element_text(face = "bold", colour = "black"),
    strip.text.y = element_text(face = "bold", colour = "black"),
    strip.background = element_rect(colour = NA, fill = "white"),
            panel.grid.minor = element_line(colour = "white"),
        panel.grid.major = element_line(colour = "white"),
    ) +
  scale_y_continuous(breaks = extended_breaks(n = 4), minor_breaks = extended_breaks(n = 6*4)) +
  scale_x_continuous(breaks = extended_breaks(n = 4), minor_breaks = extended_breaks(n = 6*4))

```

```{r figMetrics, fig.width=7, fig.height=6, include=TRUE, warning = FALSE, fig.cap="Patchiness and alignment allow for identifying spatial distributions at low (100 trees) or high (1000 trees) tree population size | Results are based from simulated data following a homogeneous (Homo.), heterogeneous (Hetero.) or route network-like (Route) distribution. The mean value is depicted by the black dot and the text. The shape of the distribution is depicted by the contour of the violins."}
  
global.ggplotLow <-
  ggplot(global.df_rdc %>% filter(Density == "Low" & (Index == "Patchiness" | Index == "Alignment")), aes(x = Distribution, Value, fill = Distribution)) +
  facet_grid(Index ~ ., scales = "free")+
  #geom_jitter(aes(color = Distribution),
  #width=0.15, alpha = 0.6)+
  geom_violin(position = position_nudge(x = 0, y = 0)) +
  
  # geom_flat_violin(position = position_nudge(x = .2, y = 0)) +
  # geom_jitter(aes(color = Distribution),
  #             width=0.15, alpha = 0.6)+
  
  stat_summary(
    #fun.data = give.n,
    geom = "text",
    fun.y = "mean",
    size = 3,
    vjust = -0.5,
    aes(label = round(after_stat(y), 2))
  ) +
  stat_summary(
    geom = "point",
    fun.y = "mean",
    size = 2,
    shape = 19
  ) +
  labs(x = "DISTRIBUTION", y = "VALUE") +
  ggtitle("Low") +
  #scale_y_continuous(sec.axis = sec_axis(~ . , name = "INDEX", breaks = NULL, labels = NULL)) +#, guide=guide_axis(position="left")
  #scale_x_discrete(sec.axis = sec_axis(~ . , name = "DENSITY", breaks = NULL, labels = NULL)) +
  # scale_fill_viridis(discrete = TRUE) +
  # scale_color_viridis(discrete = TRUE) +
  scale_fill_manual(values = c("white", "grey90", "grey80")) +
    theme(    
    strip.text.x = element_text(face = "bold", colour = "white"),
    strip.text.y = element_text(face = "bold", colour = "white"),
    strip.background = element_rect(colour = NA, fill = "white")
    ) +
  scale_y_continuous(breaks = extended_breaks(n = 4), minor_breaks = extended_breaks(n = 6*4))

global.ggplotHigh <-
  ggplot(global.df_rdc %>% filter(Density == "High" & (Index == "Patchiness" | Index == "Alignment")), aes(x = Distribution, Value, fill = Distribution)) +
  facet_grid(Index ~ ., scales = "free")+
  #geom_jitter(aes(color = Distribution),
  #width=0.15, alpha = 0.6)+
  geom_violin(position = position_nudge(x = 0, y = 0)) +
  
  # geom_flat_violin(position = position_nudge(x = .2, y = 0)) +
  # geom_jitter(aes(color = Distribution),
  #             width=0.15, alpha = 0.6)+
  
  stat_summary(
    #fun.data = give.n,
    geom = "text",
    fun.y = "mean",
    size = 3,
    vjust = -0.5,
    aes(label = round(after_stat(y), 2))
  ) +
  stat_summary(
    geom = "point",
    fun.y = "mean",
    size = 2,
    shape = 19
  ) +
  labs(x = "DISTRIBUTION", y = "") +
  ggtitle("High") +
  #scale_y_continuous(sec.axis = sec_axis(~ . , name = "INDEX", breaks = NULL, labels = NULL)) +#, guide=guide_axis(position="left")
  #scale_x_discrete(sec.axis = sec_axis(~ . , name = "DENSITY", breaks = NULL, labels = NULL)) +
  # scale_fill_viridis(discrete = TRUE) +
  # scale_color_viridis(discrete = TRUE) +
  scale_fill_manual(values = c("white", "grey90", "grey80")) +
  scale_y_continuous(breaks = extended_breaks(n = 4), minor_breaks = extended_breaks(n = 6*4))

library(ggpubr)
global.ggplot <- ggarrange(
  global.ggplotLow + guides(fill = "none"),
  global.ggplotHigh + guides(fill = "none"),
  ncol = 2
)
global.ggplot

```

## Variations in resource range shrinkage intensity

Shrinkage was affected by the forager's cognition, peaking at low cognition (Figure \@ref(fig:figShrinkage)a). Shrinkage was also driven by the forager limiting visits to tree encountered *en route*, with a maximum reached when the forager discarded all of these trees and moved directly to the target (Figure \@ref(fig:figShrinkage)b). Finally, shrinkage was removed when the competition for space between trees was high (Figure \@ref(fig:figShrinkage)c).

<!-- Rapid investigation confirmed that the competition for space was an efficient tool to counterbalance shrinkage when the forager moved only to target trees (e.g. Figure \@ref(fig:figMapShrinkage)). -->

```{r figShrinkage, fig.width=20, fig.height=5, include=TRUE, warning = FALSE, fig.cap="Shrinkage of resource range is driven by cognition, the forager's movement rules and competition for space between trees."}
shrinkageMovingRule_plot <- readRDS("../Renvironment/Plots/movingRuleShrinkage.rds")
shrinkageSpaceTree_plot <- readRDS("../Renvironment/Plots/spacingTreeShrinkage.rds")
shrinkageMain_plot <- readRDS("../Renvironment/Plots/mainShrinkage.rds")

library(ggplot2)
library(png)
library(grid)

#Homogeneous
image <- readPNG("../FIG/homogeneous.png")
rasterhomogeneous <- rasterGrob(image, interpolate = TRUE)

#Shrinked
image <- readPNG("../FIG/shrinked.png")
rasterShrunk <- rasterGrob(image, interpolate = TRUE)

#Patchiness legend
ShrunkLegend <- ggplot() +
  geom_segment(mapping = aes(x = 0, xend = 0, y = 0.1, yend = 1),
               arrow = arrow(length = unit(0.03, "npc"), ends="last"),
               color = "black",
               size = 0.7) +
  annotation_custom(rasterShrunk, xmin = 0, xmax = 0.2, ymin = 0.8, ymax = 1) + 
  annotation_custom(rasterhomogeneous, xmin = 0, xmax = 0.2, ymin = 0.1, ymax = 0.3) + 
  xlim(c(0, 0.4)) + 
  ylim(c(0, 1)) + 
  theme_void()

library(ggpubr)
mergedShrinkagePlot <- ggarrange(
  shrinkageMain_plot + scale_y_continuous(breaks = extended_breaks(n = 4), minor_breaks = extended_breaks(n = 6*4), limits = c(0,0.25)),
  shrinkageMovingRule_plot + rremove("ylab") + scale_y_continuous(breaks = extended_breaks(n = 4), minor_breaks = extended_breaks(n = 6*4), limits = c(0,0.25)),
  shrinkageSpaceTree_plot + rremove("ylab") + scale_y_continuous(breaks = extended_breaks(n = 4), minor_breaks = extended_breaks(n = 6*4), limits = c(0,0.25)),
  ShrunkLegend,
  nrow = 1,
  widths = c(0.3,0.25,0.25,0.2)
)
mergedShrinkagePlot 
```


```{r figMapShrinkage, fig.width=15, fig.height=5, include=TRUE, warning = FALSE, fig.cap="Shrinkage of resource when the forager moves directly the target tree is counterbalanced by tree space competitiong | Two illustrative maps of resource distribution when an omniscient forager moving to only the target trees was let foraging in an environment for long time for when space competition between trees was low (0.05; left) or hight (0.85; right)."}

# mapOfInterest <- readRDS("../Renvironment/Plots/mapsMovingTargetSpaceTreeLoworHigh.rds")
# mapOfInterest

```

## Variations in routine behaviour when no dispersal occurs

In the absence of seed dispersal (scenarios in Q2 were used), routine behaviour still increased (and saturated) with more advanced cognition, whatever the environment (i.e. the engineering level, Figure \@ref(fig:figRoutine2)).

```{r figRoutine2, fig.width=8, fig.height=6, include=TRUE, warning = FALSE, fig.cap=" Routine emerges when cognition is high, independent of environment engineering | The 'initial condition' of resource distribution was taken from the simulations in which a null, intermediate or omniscient forager was first let foraging. Then, those three forager types were let foraging (separately) without dispersal and routine behaviour was quantified (the tendency of the forager to target trees in a predictible way; values close to 0 indicate no predictible movement, values close to 1 indicate highly predictible movements)."}

plotRoutine2 <- readRDS("../Renvironment/Plots/routine2Plots.rds")
plotRoutine2

```


\newpage